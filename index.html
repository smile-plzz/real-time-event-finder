<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Event Finder</title>
    <!-- SEO & Mobile App Meta Tags -->
    <meta name="description" content="Find real-time events happening near you with our interactive event finder. Search by location, category, or keyword and view events on a map.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Event Finder">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png"> 
    <meta name="theme-color" content="#111827">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Leaflet.markercluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.1/dist/MarkerCluster.Default.css" />
    <style>
        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background: #1f2937; /* bg-gray-800 */
            color: #f9fafb; /* text-gray-50 */
        }
        .leaflet-popup-content a {
            color: #60a5fa; /* text-blue-400 */
        }
        .leaflet-container {
            background: #111827; /* bg-gray-900 */
        }
        .aurora-sheen {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(129, 140, 248, 0.25), transparent 55%),
                        radial-gradient(circle at 80% 10%, rgba(236, 72, 153, 0.18), transparent 60%),
                        radial-gradient(circle at 50% 80%, rgba(56, 189, 248, 0.18), transparent 55%);
            filter: blur(60px);
            opacity: 0.9;
            pointer-events: none;
        }
        .glass-card {
            backdrop-filter: blur(14px);
            background-color: rgba(17, 24, 39, 0.88);
            border: 1px solid rgba(148, 163, 184, 0.08);
            box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.65);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: all 0.2s ease-out;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: all 0.2s ease-in;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen font-sans antialiased">
    <div id="root"></div>

    <!-- React CDN -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>
    <!-- Leaflet.js JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Leaflet.markercluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.1/dist/leaflet.markercluster.js"></script>

    <script type="text/babel">
        console.log("React script started.");

        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null, errorInfo: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error: error };
            }

            componentDidCatch(error, errorInfo) {
                console.error("Uncaught error:", error, errorInfo);
                this.setState({ errorInfo: errorInfo });
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="text-center p-10 bg-red-900/20 border border-red-500 rounded-lg text-red-400">
                            <h2 className="text-xl font-bold mb-2">Something went wrong.</h2>
                            <p>We are sorry for the inconvenience. Please try refreshing the page.</p>
                            {this.state.error && <details className="mt-4 text-sm text-red-300"><summary>Error Details</summary><pre className="whitespace-pre-wrap break-all text-left">{this.state.error.toString()}\n{this.state.errorInfo?.componentStack}</pre></details>}
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        const { useState, useEffect, useRef, useCallback } = React;

        const curatedEvents = [
            {
                id: 'evt-nyc-jazz-hudson',
                name: 'Sunset Jazz on the Hudson',
                url: 'https://example.com/events/sunset-jazz-hudson',
                info: 'Grammy-winning saxophonist Lena Torres leads a quartet as the sun sets over the Hudson River.',
                pleaseNote: 'Doors open at 6:45 PM. Seating is first come, first served.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-08-15',
                        localTime: '19:30',
                        dateTime: '2024-08-15T23:30:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Music' },
                        genre: { name: 'Jazz' }
                    }
                ],
                priceRanges: [
                    { min: 45, max: 120, currency: 'USD' }
                ],
                popularity: 96,
                isTrending: true,
                tags: ['jazz', 'live music', 'nyc', 'waterfront'],
                _embedded: {
                    venues: [
                        {
                            name: 'Riverside Pier 62',
                            city: { name: 'New York' },
                            state: { name: 'NY' },
                            country: { name: 'USA' },
                            address: { line1: 'Pier 62, Chelsea Piers' },
                            location: { latitude: 40.7465, longitude: -74.0089 }
                        }
                    ]
                }
            },
            {
                id: 'evt-la-summer-beats',
                name: 'LA Summer Beats Festival',
                url: 'https://example.com/events/la-summer-beats',
                info: 'A full-day outdoor music festival featuring synth-pop, indie, and R&B headliners.',
                pleaseNote: 'Festival is cashless. Bring a refillable water bottle.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1508609349937-5ec4ae374ebf?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-09-07',
                        localTime: '12:00',
                        dateTime: '2024-09-07T19:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Music' },
                        genre: { name: 'Pop' }
                    }
                ],
                priceRanges: [
                    { min: 85, max: 220, currency: 'USD' }
                ],
                popularity: 94,
                isTrending: true,
                tags: ['festival', 'los angeles', 'outdoor'],
                _embedded: {
                    venues: [
                        {
                            name: 'Los Angeles State Historic Park',
                            city: { name: 'Los Angeles' },
                            state: { name: 'CA' },
                            country: { name: 'USA' },
                            address: { line1: '1245 N Spring St' },
                            location: { latitude: 34.0659, longitude: -118.2348 }
                        }
                    ]
                }
            },
            {
                id: 'evt-chi-hamilton-revival',
                name: 'Hamilton Revival: Chicago Residency',
                url: 'https://example.com/events/hamilton-chicago',
                info: 'The award-winning musical returns with a fresh cast and immersive staging at the CIBC Theatre.',
                pleaseNote: 'Late arrivals will be seated at intermission.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1518895949257-7621c3c786d4?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-10-03',
                        localTime: '19:00',
                        dateTime: '2024-10-04T00:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Arts & Theatre' },
                        genre: { name: 'Theatre' }
                    }
                ],
                priceRanges: [
                    { min: 95, max: 310, currency: 'USD' }
                ],
                popularity: 98,
                isTrending: true,
                tags: ['broadway', 'musical', 'chicago'],
                _embedded: {
                    venues: [
                        {
                            name: 'CIBC Theatre',
                            city: { name: 'Chicago' },
                            state: { name: 'IL' },
                            country: { name: 'USA' },
                            address: { line1: '18 W Monroe St' },
                            location: { latitude: 41.8807, longitude: -87.6291 }
                        }
                    ]
                }
            },
            {
                id: 'evt-nyc-night-market',
                name: 'Brooklyn Night Market',
                url: 'https://example.com/events/brooklyn-night-market',
                info: 'Family-friendly evening of global street food, craft vendors, and live DJs under the skyline.',
                pleaseNote: 'Pets are welcome on a leash.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-08-22',
                        localTime: '17:00',
                        dateTime: '2024-08-22T21:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Family' },
                        genre: { name: 'Fairs & Festivals' }
                    }
                ],
                priceRanges: [
                    { min: 0, max: 35, currency: 'USD' }
                ],
                popularity: 88,
                isTrending: false,
                tags: ['family', 'food', 'market', 'brooklyn'],
                _embedded: {
                    venues: [
                        {
                            name: 'Industry City Courtyard',
                            city: { name: 'Brooklyn' },
                            state: { name: 'NY' },
                            country: { name: 'USA' },
                            address: { line1: '220 36th St' },
                            location: { latitude: 40.6563, longitude: -74.0060 }
                        }
                    ]
                }
            },
            {
                id: 'evt-sea-science-expo',
                name: 'Pacific Science Expo Weekend',
                url: 'https://example.com/events/pacific-science-expo',
                info: 'Interactive exhibits, live lab demos, and space talks for curious minds ages 6 and up.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1535930749574-1399327ce78f?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-09-14',
                        localTime: '10:00',
                        dateTime: '2024-09-14T17:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Family' },
                        genre: { name: 'Science' }
                    }
                ],
                priceRanges: [
                    { min: 15, max: 55, currency: 'USD' }
                ],
                popularity: 82,
                isTrending: false,
                tags: ['science', 'family', 'seattle'],
                _embedded: {
                    venues: [
                        {
                            name: 'Pacific Science Center',
                            city: { name: 'Seattle' },
                            state: { name: 'WA' },
                            country: { name: 'USA' },
                            address: { line1: '200 2nd Ave N' },
                            location: { latitude: 47.6205, longitude: -122.3510 }
                        }
                    ]
                }
            },
            {
                id: 'evt-aus-film-nights',
                name: 'Austin Outdoor Film Nights',
                url: 'https://example.com/events/austin-film-nights',
                info: 'Weekly showcase of indie films curated by the Austin Film Society with director Q&A sessions.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-08-29',
                        localTime: '20:30',
                        dateTime: '2024-08-30T01:30:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Film' },
                        genre: { name: 'Independent' }
                    }
                ],
                priceRanges: [
                    { min: 12, max: 40, currency: 'USD' }
                ],
                popularity: 76,
                isTrending: false,
                tags: ['film', 'outdoor', 'austin'],
                _embedded: {
                    venues: [
                        {
                            name: 'Long Center Terrace',
                            city: { name: 'Austin' },
                            state: { name: 'TX' },
                            country: { name: 'USA' },
                            address: { line1: '701 W Riverside Dr' },
                            location: { latitude: 30.2606, longitude: -97.7517 }
                        }
                    ]
                }
            },
            {
                id: 'evt-bos-coastal-run',
                name: 'Boston Harbor Half Marathon',
                url: 'https://example.com/events/boston-harbor-half',
                info: 'Scenic 13.1 mile race along the harborwalk with live bands at every 5K marker.',
                pleaseNote: 'Packet pickup closes at 6:30 AM on race day.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1508609349937-5ec4ae374ebf?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-09-21',
                        localTime: '07:00',
                        dateTime: '2024-09-21T11:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Sports' },
                        genre: { name: 'Running' }
                    }
                ],
                priceRanges: [
                    { min: 95, max: 165, currency: 'USD' }
                ],
                popularity: 84,
                isTrending: false,
                tags: ['sports', 'run', 'boston'],
                _embedded: {
                    venues: [
                        {
                            name: 'Black Falcon Cruise Terminal',
                            city: { name: 'Boston' },
                            state: { name: 'MA' },
                            country: { name: 'USA' },
                            address: { line1: '1 Black Falcon Ave' },
                            location: { latitude: 42.3456, longitude: -71.0352 }
                        }
                    ]
                }
            },
            {
                id: 'evt-chi-derby-classic',
                name: 'Windy City Derby Classic',
                url: 'https://example.com/events/windy-city-derby',
                info: 'Top roller derby teams from across the Midwest battle it out in an action-packed double-header.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-08-31',
                        localTime: '18:00',
                        dateTime: '2024-08-31T23:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Sports' },
                        genre: { name: 'Extreme' }
                    }
                ],
                priceRanges: [
                    { min: 25, max: 70, currency: 'USD' }
                ],
                popularity: 78,
                isTrending: false,
                tags: ['sports', 'roller derby', 'chicago'],
                _embedded: {
                    venues: [
                        {
                            name: 'UIC Pavilion',
                            city: { name: 'Chicago' },
                            state: { name: 'IL' },
                            country: { name: 'USA' },
                            address: { line1: '525 S Racine Ave' },
                            location: { latitude: 41.8720, longitude: -87.6500 }
                        }
                    ]
                }
            },
            {
                id: 'evt-sf-modern-art',
                name: 'Modern Art After Dark',
                url: 'https://example.com/events/modern-art-after-dark',
                info: 'Late-night access to rotating exhibitions with curator-led tours and ambient DJ sets.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1530026405186-ed1f139313f8?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-09-12',
                        localTime: '21:00',
                        dateTime: '2024-09-13T04:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Arts & Theatre' },
                        genre: { name: 'Fine Art' }
                    }
                ],
                priceRanges: [
                    { min: 30, max: 80, currency: 'USD' }
                ],
                popularity: 83,
                isTrending: false,
                tags: ['art', 'museum', 'san francisco'],
                _embedded: {
                    venues: [
                        {
                            name: 'SFMOMA',
                            city: { name: 'San Francisco' },
                            state: { name: 'CA' },
                            country: { name: 'USA' },
                            address: { line1: '151 3rd St' },
                            location: { latitude: 37.7857, longitude: -122.4011 }
                        }
                    ]
                }
            },
            {
                id: 'evt-nyc-tribeca-indie',
                name: 'Tribeca Indie Showcase',
                url: 'https://example.com/events/tribeca-indie-showcase',
                info: 'Four award-winning short films followed by a panel with directors and cinematographers.',
                images: [
                    {
                        url: 'https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?auto=format&fit=crop&w=1200&q=80'
                    }
                ],
                dates: {
                    start: {
                        localDate: '2024-09-05',
                        localTime: '19:00',
                        dateTime: '2024-09-05T23:00:00Z'
                    }
                },
                classifications: [
                    {
                        segment: { name: 'Film' },
                        genre: { name: 'Independent' }
                    }
                ],
                priceRanges: [
                    { min: 18, max: 55, currency: 'USD' }
                ],
                popularity: 86,
                isTrending: true,
                tags: ['film', 'tribeca', 'screening'],
                _embedded: {
                    venues: [
                        {
                            name: 'Tribeca Performing Arts Center',
                            city: { name: 'New York' },
                            state: { name: 'NY' },
                            country: { name: 'USA' },
                            address: { line1: '199 Chambers St' },
                            location: { latitude: 40.7174, longitude: -74.0120 }
                        }
                    ]
                }
            }
        ];

        const defaultFilters = { location: '', category: '', keyword: '', dateRange: '', priceMin: '', priceMax: '' };

        const toLower = (value) => (value || '').toString().toLowerCase();

        const getEventDate = (event) => {
            const { localDate, localTime, dateTime } = event?.dates?.start || {};
            if (dateTime) return new Date(dateTime);
            if (localDate && localTime) return new Date(`${localDate}T${localTime}`);
            if (localDate) return new Date(`${localDate}T00:00:00`);
            return new Date();
        };

        const sortEventsByDate = (eventsList) => [...eventsList].sort((a, b) => getEventDate(a) - getEventDate(b));

        const matchesCategory = (event, selectedCategory) => {
            if (!selectedCategory) return true;
            const target = toLower(selectedCategory);
            return (event.classifications || []).some(classification => [classification.segment?.name, classification.genre?.name, classification.subGenre?.name]
                .filter(Boolean)
                .map(toLower)
                .some(name => name.includes(target)));
        };

        const matchesLocation = (event, locationQuery) => {
            if (!locationQuery) return true;
            const target = toLower(locationQuery);
            const venue = event._embedded?.venues?.[0];
            return [venue?.city?.name, venue?.state?.name, venue?.country?.name]
                .filter(Boolean)
                .map(toLower)
                .some(value => value.includes(target));
        };

        const matchesKeyword = (event, keyword) => {
            if (!keyword) return true;
            const target = toLower(keyword);
            const venue = event._embedded?.venues?.[0];
            const searchable = [
                event.name,
                event.info,
                event.pleaseNote,
                venue?.name,
                ...(event.tags || [])
            ].filter(Boolean).map(toLower).join(' ');
            return searchable.includes(target);
        };

        const matchesDateRange = (event, dateRange) => {
            if (!dateRange) return true;
            const eventDate = getEventDate(event);
            const now = new Date();
            const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const startOfTomorrow = new Date(startOfToday);
            startOfTomorrow.setDate(startOfTomorrow.getDate() + 1);

            if (dateRange === 'today') {
                return eventDate >= startOfToday && eventDate < startOfTomorrow;
            }

            if (dateRange === 'thisWeekend') {
                const dayOfWeek = now.getDay();
                const saturday = new Date(startOfToday);
                saturday.setDate(startOfToday.getDate() + ((6 - dayOfWeek + 7) % 7));
                const sunday = new Date(saturday);
                sunday.setDate(saturday.getDate() + 1);
                const endOfSunday = new Date(sunday);
                endOfSunday.setHours(23, 59, 59, 999);
                return eventDate >= saturday && eventDate <= endOfSunday;
            }

            if (dateRange === 'next7Days') {
                const end = new Date(startOfToday);
                end.setDate(startOfToday.getDate() + 7);
                return eventDate >= startOfToday && eventDate <= end;
            }

            return true;
        };

        const matchesPriceRange = (event, minPrice, maxPrice) => {
            const priceRange = event.priceRanges?.[0];
            if (!priceRange) return true;
            const min = minPrice ? parseFloat(minPrice) : null;
            const max = maxPrice ? parseFloat(maxPrice) : null;
            if (min !== null && priceRange.max < min) return false;
            if (max !== null && priceRange.min > max) return false;
            return true;
        };

        const filterEvents = (eventsList, filters) => {
            return sortEventsByDate(eventsList.filter(event =>
                matchesLocation(event, filters.location) &&
                matchesCategory(event, filters.category) &&
                matchesKeyword(event, filters.keyword) &&
                matchesDateRange(event, filters.dateRange) &&
                matchesPriceRange(event, filters.priceMin, filters.priceMax)
            ));
        };

        const toRadians = (value) => value * Math.PI / 180;

        const getDistanceInKm = (coordA, coordB) => {
            const earthRadiusKm = 6371;
            const dLat = toRadians(coordB.latitude - coordA.latitude);
            const dLon = toRadians(coordB.longitude - coordA.longitude);
            const lat1 = toRadians(coordA.latitude);
            const lat2 = toRadians(coordB.latitude);

            const a = Math.sin(dLat / 2) ** 2 + Math.sin(dLon / 2) ** 2 * Math.cos(lat1) * Math.cos(lat2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return earthRadiusKm * c;
        };

        const StatPill = ({ icon, label, value }) => (
            <div className="glass-card rounded-2xl px-5 py-4 flex items-center gap-4 border border-gray-800/60">
                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-600/30 via-purple-500/20 to-blue-500/20 flex items-center justify-center text-purple-300 text-xl">
                    <i className={icon}></i>
                </div>
                <div>
                    <p className="text-sm uppercase tracking-wide text-gray-400">{label}</p>
                    <p className="text-2xl font-semibold text-white">{value}</p>
                </div>
            </div>
        );

        const HeroSection = ({ onExplore, stats }) => (
            <section className="relative overflow-hidden rounded-3xl border border-gray-800 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-950 px-6 py-10 md:px-10 md:py-16 shadow-2xl">
                <div className="aurora-sheen"></div>
                <div className="relative z-10 flex flex-col gap-8 md:flex-row md:items-center md:justify-between">
                    <div className="max-w-2xl">
                        <span className="inline-flex items-center gap-2 rounded-full border border-purple-500/30 bg-purple-500/10 px-4 py-1 text-sm text-purple-200 mb-4 floating">
                            <i className="fas fa-bolt"></i>
                            Live curated events, updated in real-time
                        </span>
                        <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight text-white leading-tight">
                            Discover unforgettable moments around you
                        </h1>
                        <p className="mt-5 text-lg text-gray-300 max-w-xl">
                            Search, save, and explore concerts, sports, theatre, and more. Switch between immersive map and rich list views, then set reminders so you never miss a beat.
                        </p>
                        <div className="mt-8 flex flex-col sm:flex-row gap-4 sm:items-center">
                            <button onClick={onExplore} className="inline-flex items-center justify-center rounded-full bg-gradient-to-r from-purple-600 via-fuchsia-600 to-blue-500 px-6 py-3 text-base font-semibold text-white shadow-lg shadow-purple-900/30 hover:shadow-purple-800/50 transition-transform hover:-translate-y-0.5">
                                <i className="fas fa-compass mr-2"></i> Explore events now
                            </button>
                            <div className="flex items-center text-sm text-gray-400">
                                <i className="fas fa-shield-alt text-purple-300 mr-2"></i>
                                Privacy-friendly — no account required
                            </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full max-w-md md:max-w-lg">
                        <StatPill icon="fas fa-calendar-check" label="Events Found" value={stats.totalResults} />
                        <StatPill icon="fas fa-bookmark" label="Saved" value={stats.savedCount} />
                        <StatPill icon="fas fa-fire" label="Trending" value={stats.trendingCount} />
                    </div>
                </div>
            </section>
        );

        const ViewToggle = ({ view, onChange }) => (
            <div className="glass-card flex items-center justify-center gap-3 rounded-full border border-gray-800/60 p-1.5 mx-auto w-full sm:w-auto">
                <button onClick={() => onChange('list')} className={`flex items-center gap-2 rounded-full px-5 py-2 text-sm sm:text-base font-semibold transition-all ${view === 'list' ? 'bg-purple-600 text-white shadow-lg shadow-purple-900/30' : 'text-gray-300 hover:text-white hover:bg-gray-800/80'}`}>
                    <i className="fas fa-stream"></i>
                    List View
                </button>
                <button onClick={() => onChange('map')} className={`flex items-center gap-2 rounded-full px-5 py-2 text-sm sm:text-base font-semibold transition-all ${view === 'map' ? 'bg-purple-600 text-white shadow-lg shadow-purple-900/30' : 'text-gray-300 hover:text-white hover:bg-gray-800/80'}`}>
                    <i className="fas fa-map-marked-alt"></i>
                    Map View
                </button>
            </div>
        );

        const App = () => {
            const [events, setEvents] = useState(() => sortEventsByDate(curatedEvents));
            const [savedEvents, setSavedEvents] = useState(() => {
                try {
                    const localData = localStorage.getItem('savedEvents');
                    return localData ? JSON.parse(localData) : [];
                } catch (error) {
                    console.error("Error parsing saved events from localStorage:", error);
                    return [];
                }
            });
            const [filters, setFilters] = useState(() => ({ ...defaultFilters }));
            const [view, setView] = useState('list'); // 'list' or 'map'
            const [notificationPermission, setNotificationPermission] = useState(() => "Notification" in window ? Notification.permission : 'default');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [selectedEvent, setSelectedEvent] = useState(null); // New state for selected event
            const [trendingEvents, setTrendingEvents] = useState([]); // New state for trending events
            const loadingTimeout = useRef(null);

            useEffect(() => {
                localStorage.setItem('savedEvents', JSON.stringify(savedEvents));
            }, [savedEvents]);

            const finishLoading = useCallback(() => {
                if (loadingTimeout.current) {
                    clearTimeout(loadingTimeout.current);
                }
                loadingTimeout.current = setTimeout(() => {
                    setIsLoading(false);
                    loadingTimeout.current = null;
                }, 200);
            }, []);

            const fetchEvents = useCallback((currentFilters = filters) => {
                if (loadingTimeout.current) {
                    clearTimeout(loadingTimeout.current);
                }
                setIsLoading(true);
                setError(null);
                try {
                    const curatedResults = filterEvents(curatedEvents, currentFilters);
                    setEvents(curatedResults);
                    if (curatedResults.length === 0) {
                        setError(null);
                    }
                } catch (err) {
                    console.error("Error filtering curated events:", err);
                    setError('We had trouble curating events for your search. Please adjust your filters and try again.');
                } finally {
                    finishLoading();
                }
            }, [filters, finishLoading]);

            useEffect(() => {
                const trending = sortEventsByDate(curatedEvents.filter(event => event.isTrending))
                    .sort((a, b) => b.popularity - a.popularity)
                    .slice(0, 6);
                setTrendingEvents(trending);
            }, []);

            useEffect(() => {
                requestNotificationPermission();
            }, []);

            const requestNotificationPermission = () => {
                if ("Notification" in window && Notification.permission !== "granted") {
                    Notification.requestPermission().then(setNotificationPermission);
                }
            };

            const handleFilterChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
            };

            const handleGeolocation = () => {
                if (navigator.geolocation) {
                    setIsLoading(true);
                    setError(null);
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            const nearby = curatedEvents
                                .map(event => {
                                    const venue = event._embedded?.venues?.[0];
                                    if (!venue?.location) {
                                        return { event, distance: Number.POSITIVE_INFINITY };
                                    }
                                    const distance = getDistanceInKm(
                                        { latitude, longitude },
                                        { latitude: Number(venue.location.latitude), longitude: Number(venue.location.longitude) }
                                    );
                                    return { event, distance };
                                })
                                .filter(item => Number.isFinite(item.distance))
                                .sort((a, b) => a.distance - b.distance);

                            const within150Km = nearby.filter(item => item.distance <= 150).map(item => item.event);
                            const curatedNearby = within150Km.length > 0 ? within150Km : nearby.slice(0, 6).map(item => item.event);
                            setEvents(sortEventsByDate(curatedNearby));

                            if (curatedNearby.length > 0) {
                                const venue = curatedNearby[0]._embedded?.venues?.[0];
                                if (venue?.city?.name) {
                                    setFilters(prev => ({ ...prev, location: venue.city.name }));
                                }
                            }
                            finishLoading();
                        },
                        (err) => {
                            console.error("Geolocation error:", err);
                            alert("Unable to retrieve your location.");
                            finishLoading();
                        }
                    );
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            };
            
            const clearFilters = () => {
                setFilters({ ...defaultFilters });
                fetchEvents({ ...defaultFilters }); // Trigger search after clearing
            };

            useEffect(() => () => {
                if (loadingTimeout.current) {
                    clearTimeout(loadingTimeout.current);
                }
            }, []);

            const saveEvent = (event) => {
                setSavedEvents(prev => prev.some(e => e.id === event.id) ? prev : [...prev, { ...event, notes: '' }]);
            };

            const removeSavedEvent = (eventId) => {
                setSavedEvents(prev => prev.filter(event => event.id !== eventId));
            };

            const updateSavedEventNotes = (eventId, notes) => {
                setSavedEvents(prev => prev.map(event => event.id === eventId ? { ...event, notes } : event));
            };

            const scheduleNotification = (event, time) => {
                if ("Notification" in window && notificationPermission === "granted") {
                    const eventDate = new Date(event.dates.start.dateTime);
                    const reminderTime = new Date(eventDate.getTime() - time * 60 * 1000);
                    if (reminderTime > new Date()) {
                        setTimeout(() => {
                            new Notification(event.name, { body: `Reminder: Your event is starting soon!`, icon: event.images?.[0]?.url });
                        }, reminderTime.getTime() - new Date().getTime());
                        alert(`Reminder set for ${event.name}`);
                    } else {
                        alert("Cannot schedule reminder for a past event.");
                    }
                } else {
                    alert("Please grant notification permissions.");
                }
            };

            const handleShare = async (event) => {
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: event.name,
                            text: `Check out this event: ${event.name} at ${event._embedded?.venues?.[0]?.name || 'N/A'}!`,
                            url: event.url,
                        });
                        console.log('Event shared successfully');
                    } catch (error) {
                        console.error('Error sharing event:', error);
                    }
                } else {
                    // Fallback for browsers that do not support Web Share API
                    const eventDetails = `Event: ${event.name}\nVenue: ${event._embedded?.venues?.[0]?.name || 'N/A'}\nGet Tickets: ${event.url}`;
                    navigator.clipboard.writeText(eventDetails).then(() => {
                        alert('Event details copied to clipboard!');
                    }).catch(err => {
                        console.error('Could not copy text: ', err);
                        alert('Could not copy event details.');
                    });
                }
            };

            const LoadingSpinner = () => (
                <div className="flex justify-center items-center p-10"><div className="w-16 h-16 border-4 border-purple-400 border-t-transparent rounded-full animate-spin"></div></div>
            );

            const ErrorDisplay = ({ message }) => (
                <div className="text-center p-10 bg-red-900/20 border border-red-500 rounded-lg"><p className="text-red-400 font-semibold">Oops!</p><p className="text-red-300">{message}</p></div>
            );

            const EventDetailModal = ({ event, onClose, handleShare }) => {
                const modalRef = useRef(null);

                useEffect(() => {
                    const handleEscape = (e) => {
                        if (e.key === 'Escape') onClose();
                    };
                    document.addEventListener('keydown', handleEscape);
                    return () => document.removeEventListener('keydown', handleEscape);
                }, [onClose]);

                if (!event) return null;

                const imageUrl = event.images?.[0]?.url || 'https://via.placeholder.com/800x400/1f2937/FFFFFF?text=No+Image';
                const venueName = event._embedded?.venues?.[0]?.name || 'N/A';
                const city = event._embedded?.venues?.[0]?.city?.name || 'N/A';
                const state = event._embedded?.venues?.[0]?.state?.name || '';
                const country = event._embedded?.venues?.[0]?.country?.name || '';
                const address = event._embedded?.venues?.[0]?.address?.line1 || '';
                const displayLocation = [address, city, state, country].filter(Boolean).join(', ');

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center p-4 z-50 modal-enter modal-enter-active" onClick={onClose} role="dialog" aria-modal="true" tabIndex="-1">
                        <div className="bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto transform transition-all scale-100 opacity-100" onClick={e => e.stopPropagation()} ref={modalRef}>
                            <div className="relative">
                                <img src={imageUrl} alt={event.name} className="w-full h-64 object-cover rounded-t-lg"/>
                                <button onClick={onClose} className="absolute top-3 right-3 bg-gray-700 hover:bg-gray-600 text-white rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-purple-500" aria-label="Close event details">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                            <div className="p-6">
                                <h2 className="text-3xl font-bold text-gray-100 mb-3">{event.name}</h2>
                                <p className="text-gray-300 mb-2"><i className="fas fa-calendar-alt mr-2"></i>Date: {event.dates.start.localDate} at {event.dates.start.localTime}</p>
                                <p className="text-gray-300 mb-2"><i className="fas fa-map-marker-alt mr-2"></i>Venue: {venueName} - {displayLocation}</p>
                                {event.info && <p className="text-gray-300 mb-4">**Info:** {event.info}</p>}
                                {event.pleaseNote && <p className="text-gray-300 mb-4">**Please Note:** {event.pleaseNote}</p>}
                                {event.priceRanges && (
                                    <p className="text-gray-300 mb-4">
                                        **Price Range:** {event.priceRanges[0].min} - {event.priceRanges[0].max} {event.priceRanges[0].currency}
                                    </p>
                                )}
                                <div className="flex flex-wrap gap-3 mt-4">
                                    <a href={event.url} target="_blank" rel="noopener noreferrer" className="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                                        <i className="fas fa-ticket-alt mr-2"></i>Get Tickets
                                    </a>
                                    <button onClick={() => handleShare(event)} className="inline-flex items-center bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                                        <i className="fas fa-share-alt mr-2"></i>Share Event
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const EventCard = ({ event, onSave, onRemove, onUpdateNotes, isSaved, onScheduleNotification, onViewDetails, handleShare }) => {
                const [showNotes, setShowNotes] = useState(false);
                const [notes, setNotes] = useState(event.notes || '');
                const [reminderMinutes, setReminderMinutes] = useState(30);
                const imageUrl = event.images?.[0]?.url || 'https://via.placeholder.com/400x200/1f2937/FFFFFF?text=No+Image';
                return (
                    <div className="glass-card rounded-3xl overflow-hidden transition duration-300 hover:-translate-y-1 hover:shadow-purple-500/30 fade-in group">
                        <img src={imageUrl} alt={event.name} className="w-full h-56 object-cover" loading="lazy"/>
                        <div className="p-6">
                            <h3 className="font-bold text-xl md:text-2xl mb-2 text-gray-100 leading-tight">{event.name}</h3>
                            <p className="text-gray-400 text-sm mb-1"><i className="fas fa-calendar-alt mr-2"></i>{event.dates.start.localDate} at {event.dates.start.localTime}</p>
                            <p className="text-gray-400 text-sm mb-2"><i className="fas fa-map-marker-alt mr-2"></i>{event._embedded?.venues?.[0]?.name} - {event._embedded?.venues?.[0]?.city?.name}</p>
                            <a href={event.url} target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline text-base font-medium"><i className="fas fa-ticket-alt mr-2"></i>Get Tickets</a>
                            <div className="mt-4 flex flex-wrap gap-2">
                                {isSaved ? (
                                    <><button onClick={() => onRemove(event.id)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-trash-alt mr-2"></i>Remove</button><button onClick={() => setShowNotes(!showNotes)} className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-sticky-note mr-2"></i>{showNotes ? 'Hide' : 'Notes'}</button></>
                                ) : (
                                    <button onClick={() => onSave(event)} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-bookmark mr-2"></i>Save</button>
                                )}
                                <button onClick={() => onViewDetails(event)} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-info-circle mr-2"></i>Details</button>
                                <button onClick={() => handleShare(event)} className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-share-alt mr-2"></i>Share</button>
                            </div>
                            {isSaved && showNotes && (
                                <div className="mt-5 p-4 bg-gray-700 rounded-lg border border-gray-600 fade-in">
                                    <textarea className="w-full p-3 border-gray-600 bg-gray-800 rounded-md focus:ring-purple-500 text-sm mb-3 text-white" placeholder="Add notes..." value={notes} onChange={(e) => { setNotes(e.target.value); onUpdateNotes(event.id, e.target.value); }}></textarea>
                                    <div className="flex items-center space-x-3">
                                        <select value={reminderMinutes} onChange={(e) => setReminderMinutes(parseInt(e.target.value))} className="p-2 border-gray-600 bg-gray-800 rounded-md text-sm focus:ring-purple-500 text-white"><option value="30">30 mins before</option><option value="60">1 hour before</option></select>
                                        <button onClick={() => onScheduleNotification(event, reminderMinutes)} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg text-sm"><i className="fas fa-bell mr-2"></i>Set Reminder</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const EventList = ({ events, ...props }) => (
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {events.length > 0 ? (
                        events.map(event => <EventCard key={event.id} event={event} {...props} />)
                    ) : (
                        <div className="col-span-full glass-card rounded-3xl border border-gray-800/70 px-6 py-16 text-center">
                            <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-purple-500/10 text-2xl text-purple-300">
                                <i className="fas fa-search"></i>
                            </div>
                            <h3 className="text-2xl font-semibold text-white mb-2">No events found</h3>
                            <p className="text-gray-400 max-w-xl mx-auto">Try adjusting your filters or explore nearby cities to uncover more happenings.</p>
                        </div>
                    )}
                </div>
            );

            const FilterBar = ({ filters, onChange, onGeolocation, onClear, onSearch }) => {
                const categories = ["Music", "Sports", "Arts & Theatre", "Family", "Film"];
                return (
                    <div className="relative overflow-hidden rounded-3xl border border-gray-800/80 bg-gray-900/60 p-6 md:p-8 shadow-2xl glass-card">
                        <div className="absolute inset-0 opacity-60 aurora-sheen"></div>
                        <div className="relative z-10">
                            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-semibold text-white">Fine-tune your event feed</h2>
                                    <p className="text-sm text-gray-400 mt-1">Filter by location, vibe, date, and budget for a tailored experience.</p>
                                </div>
                                <button onClick={onGeolocation} className="inline-flex items-center gap-2 rounded-full border border-blue-400/40 bg-blue-500/10 px-4 py-2 text-sm font-semibold text-blue-200 hover:bg-blue-500/20 transition-colors">
                                    <i className="fas fa-location-arrow"></i>
                                    Use my location
                                </button>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-4 mb-4">
                                <div className="lg:col-span-4 relative">
                                    <input type="text" name="location" value={filters.location} onChange={onChange} placeholder="Location (City)" className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 pr-11 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60"/>
                                    <i className="fas fa-map-marker-alt absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                </div>
                                <div className="lg:col-span-3">
                                    <select name="category" value={filters.category} onChange={onChange} className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60">
                                        <option value="">All Categories</option>
                                        {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                    </select>
                                </div>
                                <div className="lg:col-span-5 relative">
                                    <input type="text" name="keyword" value={filters.keyword} onChange={onChange} placeholder="Keyword (e.g., concert, comedy)" className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 pr-11 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60"/>
                                    <i className="fas fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <select name="dateRange" value={filters.dateRange} onChange={onChange} className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60">
                                    <option value="">Any Date</option>
                                    <option value="today">Today</option>
                                    <option value="thisWeekend">This Weekend</option>
                                    <option value="next7Days">Next 7 Days</option>
                                </select>
                                <input type="number" name="priceMin" value={filters.priceMin} onChange={onChange} placeholder="Min Price" className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60"/>
                                <input type="number" name="priceMax" value={filters.priceMax} onChange={onChange} placeholder="Max Price" className="w-full rounded-2xl border border-gray-700/80 bg-gray-900/80 px-4 py-3 text-sm text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500/60"/>
                            </div>

                            <div className="flex flex-col sm:flex-row gap-4">
                                <button onClick={() => onSearch(filters)} className="w-full inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-purple-600 via-fuchsia-600 to-blue-500 px-6 py-3 text-base font-semibold text-white shadow-lg shadow-purple-900/30 transition-transform hover:-translate-y-0.5">
                                    <i className="fas fa-search"></i>
                                    Search events
                                </button>
                                <button onClick={onClear} className="w-full inline-flex items-center justify-center gap-2 rounded-2xl border border-gray-700/80 bg-gray-900/60 px-6 py-3 text-base font-semibold text-gray-300 hover:text-white hover:border-purple-500/60 hover:bg-gray-900/80">
                                    <i className="fas fa-undo"></i>
                                    Clear filters
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const SavedEvents = ({ savedEvents, ...props }) => (
                <div className="mt-14 rounded-3xl border border-gray-800/80 bg-gray-900/70 p-6 md:p-8 shadow-2xl glass-card">
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-100 mb-6 text-center">My Saved Events</h2>
                    {savedEvents.length > 0 ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            {savedEvents.map(event => <EventCard key={event.id} event={event} isSaved={true} {...props} />)}
                        </div>
                    ) : (
                        <div className="glass-card rounded-3xl border border-gray-800/70 px-6 py-16 text-center">
                            <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10 text-2xl text-green-300">
                                <i className="fas fa-bookmark"></i>
                            </div>
                            <h3 className="text-2xl font-semibold text-white mb-2">No saved events yet</h3>
                            <p className="text-gray-400 max-w-2xl mx-auto">Bookmark upcoming experiences to build your personal itinerary. Saved events stay synced across visits on this device.</p>
                        </div>
                    )}
                </div>
            );

            const MapView = ({ events }) => {
                const mapRef = useRef(null);
                const mapInstance = useRef(null);
                const markers = useRef(null);

                useEffect(() => {
                    if (typeof L === 'undefined') return;
                    if (!mapInstance.current && mapRef.current) {
                        mapInstance.current = L.map(mapRef.current).setView([40.7128, -74.0060], 10);
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 19 }).addTo(mapInstance.current);
                        markers.current = L.markerClusterGroup();
                        mapInstance.current.addLayer(markers.current);
                    }

                    markers.current.clearLayers();
                    const eventMarkers = [];
                    events.forEach(event => {
                        const venue = event._embedded?.venues?.[0];
                        if (venue?.location) {
                            const marker = L.marker([venue.location.latitude, venue.location.longitude]);
                            const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${venue.location.latitude},${venue.location.longitude}`;
                            marker.bindPopup(`
                                <b>${event.name}</b><br>
                                ${venue.name}<br>
                                <a href="${event.url}" target="_blank">Get Tickets</a><br>
                                <a href="${directionsUrl}" target="_blank" class="text-blue-400 hover:underline mt-2 inline-block"><i class="fas fa-directions mr-1"></i>Directions</a>
                            `);
                            eventMarkers.push(marker);
                        }
                    });

                    if (eventMarkers.length > 0) {
                        markers.current.addLayers(eventMarkers);
                        const bounds = L.featureGroup(eventMarkers).getBounds();
                        if (bounds.isValid()) mapInstance.current.fitBounds(bounds.pad(0.1));
                    }
                }, [events]);

                return <div ref={mapRef} className="glass-card w-full h-[420px] md:h-[620px] rounded-3xl border border-gray-800/70 overflow-hidden mt-10"></div>;
            };

            const TrendingEvents = ({ events, ...props }) => {
                if (events.length === 0) return null;
                return (
                    <div className="mt-14 rounded-3xl border border-purple-500/20 bg-gradient-to-br from-purple-900/30 via-gray-900/70 to-blue-900/20 p-6 md:p-8 shadow-2xl glass-card">
                        <div className="flex flex-col items-center gap-3 mb-6 text-center">
                            <span className="inline-flex items-center gap-2 rounded-full border border-purple-400/30 bg-purple-500/10 px-4 py-1 text-xs font-semibold uppercase tracking-wider text-purple-200">
                                <i className="fas fa-fire"></i>
                                Hot right now
                            </span>
                            <h2 className="text-2xl md:text-3xl font-bold text-gray-100">Trending Events</h2>
                            <p className="text-gray-400 max-w-2xl">Curated picks rising in popularity — discover what other locals are booking this week.</p>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            {events.map(event => <EventCard key={event.id} event={event} {...props} />)}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-b from-gray-950 via-gray-900 to-black text-gray-100">
                    <div className="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 pb-20 space-y-12">
                        <HeroSection onExplore={() => fetchEvents(filters)} stats={{ totalResults: events.length, savedCount: savedEvents.length, trendingCount: trendingEvents.length }} />
                        <FilterBar filters={filters} onChange={handleFilterChange} onGeolocation={handleGeolocation} onClear={clearFilters} onSearch={fetchEvents} />
                        <div className="flex justify-center">
                            <ViewToggle view={view} onChange={setView} />
                        </div>
                        <div>
                            {isLoading ? <LoadingSpinner /> : error ? <ErrorDisplay message={error} /> : (
                                view === 'list' ? (
                                    <EventList events={events} savedEvents={savedEvents} onSave={saveEvent} onRemove={removeSavedEvent} onUpdateNotes={updateSavedEventNotes} onScheduleNotification={scheduleNotification} onViewDetails={setSelectedEvent} handleShare={handleShare} />
                                ) : (
                                    <MapView events={events} />
                                )
                            )}
                        </div>
                        <SavedEvents savedEvents={savedEvents} onSave={saveEvent} onRemove={removeSavedEvent} onUpdateNotes={updateSavedEventNotes} onScheduleNotification={scheduleNotification} onViewDetails={setSelectedEvent} handleShare={handleShare} />
                        <TrendingEvents events={trendingEvents} savedEvents={savedEvents} onSave={saveEvent} onRemove={removeSavedEvent} onUpdateNotes={updateSavedEventNotes} onScheduleNotification={scheduleNotification} onViewDetails={setSelectedEvent} handleShare={handleShare} />
                        {selectedEvent && <EventDetailModal event={selectedEvent} onClose={() => setSelectedEvent(null)} handleShare={handleShare} />}
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>